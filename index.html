
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç¥çµŒè¡°å¼±ï¼ˆæœ€å¤§4äººå¯¾æˆ¦ï¼‰</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    #preview img { border:1px solid #aaa; margin:4px; width:60px; }
    #preview button {
      position:absolute; top:-10px; right:-10px;
      background:red; color:white; border:none; border-radius:50%; cursor:pointer;
    }
    .card { width:80px; height:80px; margin:4px; display:inline-block; border:1px solid #ccc; background:#eee; cursor:pointer; background-size:cover; }
    .hidden { background:#999 !important; }
    #modalOverlay {
      position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:none; justify-content:center; align-items:center; z-index:10;
    }
    #modalOverlay img { max-width:60%; border:5px solid white; border-radius:8px; }
  </style>
</head>
<body>
<h2 id="title">ç¥çµŒè¡°å¼±ï¼ˆæœ€å¤§4äººå¯¾æˆ¦ï¼‰</h2>
<div>
  <label><span id="langLabel">è¨€èª:</span>
    <select id="lang" onchange="setLanguage()">
      <option value="ja">æ—¥æœ¬èª</option><option value="en">English</option>
    </select>
  </label>
  <label><span id="countLabel">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼äººæ•°:</span>
    <select id="playerCount" onchange="drawPlayerNames()">
      <option value="1">1</option><option value="2" selected>2</option><option value="3">3</option><option value="4">4</option>
    </select>
  </label>
</div>
<div id="playerNames" style="margin-top:10px;"></div>
<p>
  <input type="file" id="imgInput" accept="image/*">
  <button onclick="addImage()" id="addBtn">ï¼‹ç”»åƒã‚’è¿½åŠ </button>
  <button onclick="toggleUploaded()" id="toggleBtn">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒã‚’è¡¨ç¤º</button>
</p>
<div id="preview"></div>
<p><button id="startBtn" disabled onclick="startGame()">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button></p>
<hr>
<div id="status"></div>
<div id="gameArea"></div>

<div id="modalOverlay" onclick="hideModal()"><img id="modalImg" src=""></div>

<script>
let imgs = [], isGameStarted = false, flipped = [], matched = [], cards = [];
let turn = 0, scores = [], lang = "ja", playerNames = [];

const text = {
  ja: {
    title: "ç¥çµŒè¡°å¼±ï¼ˆæœ€å¤§4äººå¯¾æˆ¦ï¼‰",
    langLabel: "è¨€èª:",
    countLabel: "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼äººæ•°:",
    add: "ï¼‹ç”»åƒã‚’è¿½åŠ ",
    toggle: "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒã‚’è¡¨ç¤º",
    start: "ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ",
    score: "ã‚¹ã‚³ã‚¢",
    turn: "ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼",
    win: "ã®å‹ã¡ã§ã™ï¼",
    draw: "å¼•ãåˆ†ã‘ã§ã™ï¼"
  },
  en: {
    title: "Photo Memory Game (Up to 4 Players)",
    langLabel: "Language:",
    countLabel: "Players:",
    add: "+ Add Image",
    toggle: "Toggle Uploaded Images",
    start: "Start Game",
    score: "Score",
    turn: "Current Player",
    win: " wins!",
    draw: "It's a draw!"
  }
};

function setLanguage() {
  lang = document.getElementById("lang").value;
  document.getElementById("title").textContent = text[lang].title;
  document.getElementById("langLabel").textContent = text[lang].langLabel;
  document.getElementById("countLabel").textContent = text[lang].countLabel;
  document.getElementById("addBtn").textContent = text[lang].add;
  document.getElementById("toggleBtn").textContent = text[lang].toggle;
  document.getElementById("startBtn").textContent = text[lang].start;
  drawPlayerNames();
}

function drawPlayerNames() {
  const pn = document.getElementById("playerNames");
  const count = parseInt(document.getElementById("playerCount").value);
  pn.innerHTML = "";
  playerNames = [];
  for (let i = 0; i < count; i++) {
    const label = document.createElement("label");
    label.textContent = lang === "ja" ? `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i+1}ï¼š` : `Player ${i+1}:`;
    const input = document.createElement("input");
    input.type = "text";
    input.placeholder = lang === "ja" ? `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i+1}` : `Player ${i+1}`;
    input.id = `pname${i+1}`;
    pn.appendChild(label);
    pn.appendChild(input);
    pn.appendChild(document.createElement("br"));
  }
}

function addImage() {
  const fileInput = document.getElementById("imgInput");
  const file = fileInput.files[0];
  if (file && file.type.startsWith("image/")) {
    const reader = new FileReader();
    reader.onload = ev => {
      imgs.push(ev.target.result);
      drawPreview();
      document.getElementById("startBtn").disabled = imgs.length < 2;
    };
    reader.readAsDataURL(file);
  }
}

function drawPreview() {
  const preview = document.getElementById("preview");
  preview.innerHTML = "";
  imgs.forEach((src, i) => {
    const wrapper = document.createElement("div");
    wrapper.style.display = "inline-block";
    wrapper.style.position = "relative";
    wrapper.style.margin = "4px";

    const im = new Image();
    im.src = src;
    im.width = 60;

    const del = document.createElement("button");
    del.textContent = "Ã—";
    del.onclick = () => {
      imgs.splice(i, 1);
      drawPreview();
      document.getElementById("startBtn").disabled = imgs.length < 2;
    };

    wrapper.appendChild(im);
    wrapper.appendChild(del);
    preview.appendChild(wrapper);
  });
}

function toggleUploaded() {
  const pre = document.getElementById("preview");
  pre.style.display = pre.style.display === "none" ? "block" : "none";
}

function startGame() {
  const area = document.getElementById("gameArea");
  area.innerHTML = "";
  const names = [];
  const count = parseInt(document.getElementById("playerCount").value);
  for (let i = 0; i < count; i++) {
    const val = document.getElementById(`pname${i+1}`).value.trim();
    names.push(val || (lang === "ja" ? `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i+1}` : `Player ${i+1}`));
  }
  playerNames = names;
  scores = Array(count).fill(0);
  turn = 0;
  cards = [...imgs, ...imgs].sort(() => Math.random() - 0.5);
  matched = Array(cards.length).fill(false);
  isGameStarted = true;
  drawStatus();
  cards.forEach((src, idx) => {
    const card = document.createElement("div");
    card.className = "card hidden";
    card.onclick = () => flipCard(idx, card);
    area.appendChild(card);
  });
}

function drawStatus() {
  const s = playerNames.map((n, i) => `${n}: ${scores[i]}`).join(" / ");
  document.getElementById("status").textContent =
    `${text[lang].turn}: ${playerNames[turn]} ï½œ ${text[lang].score}: ${s}`;
}

function flipCard(idx, el) {
  if (!isGameStarted || flipped.length === 2 || matched[idx]) return;
  el.classList.remove("hidden");
  el.style.backgroundImage = `url('${cards[idx]}')`;
  flipped.push({idx, el});
  if (flipped.length === 2) checkMatch();
}

function checkMatch() {
  const [a, b] = flipped;
  if (cards[a.idx] === cards[b.idx]) {
    matched[a.idx] = matched[b.idx] = true;
    showModal(cards[a.idx]);
    scores[turn]++;
    setTimeout(() => {
      flipped = [];
      drawStatus();
      if (matched.every(x => x)) {
        declareWinner();
      }
    }, 600);
  } else {
    setTimeout(() => {
      a.el.classList.add("hidden");
      b.el.classList.add("hidden");
      a.el.style.backgroundImage = b.el.style.backgroundImage = "";
      flipped = [];
      turn = (turn + 1) % scores.length;
      drawStatus();
    }, 800);
  }
}

function declareWinner() {
  const max = Math.max(...scores);
  const winners = playerNames.filter((_, i) => scores[i] === max);
  const msg = winners.length === 1 ? winners[0] + text[lang].win : text[lang].draw;
  alert(msg);
}

function showModal(src) {
  const overlay = document.getElementById("modalOverlay");
  document.getElementById("modalImg").src = src;
  overlay.style.display = "flex";
}

function hideModal() {
  document.getElementById("modalOverlay").style.display = "none";
}

window.onload = () => {
  setLanguage();
};
</script>
</body>
</html>

  cards = [...imgs, ...imgs].sort(() => Ma"none";
}

window.onload = () => {
</div>
<div id="playerNames" style="margin-top:10px;"></div>
<p>
  <input type="file" id="imgInput" accept="image/*">
  <button onclick="addImage()" id="addBtn">ï¼‹ç”»åƒã‚’è¿½åŠ </button>
  <button onclick="toggleUploaded()" id="toggleBtn">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒã‚’è¡¨ç¤º</button>
</p>
<div id="preview"></div>
<p><button id="startBtn" disabled onclick="startGame()">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button></p>
<hr>
<div id="status"></div>
<div id="gameArea"></div>

<div id="modalOverlay" onclick="hideModal()"><img id="modalImg" src=""></div>

<script>
let imgs = [], isGameStarted = false, flipped = [], matched = [], cards = [];
let turn = 0, scores = [], lang = "ja", playerNames = [];

const text = {
  ja: {
    title: "ç¥çµŒè¡°å¼±ï¼ˆæœ€å¤§4äººå¯¾æˆ¦ï¼‰",
    langLabel: "è¨€èª:",
    countLabel: "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼äººæ•°:",
    add: "ï¼‹ç”»åƒã‚’è¿½åŠ ",
    toggle: "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒã‚’è¡¨ç¤º",
    start: "ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ",
    score: "ã‚¹ã‚³ã‚¢",
    turn: "ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼",
    win: "ã®å‹ã¡ã§ã™ï¼",
    draw: "å¼•ãåˆ†ã‘ã§ã™ï¼"
  },
  en: {
    title: "Photo Memory Game (Up to 4 Players)",
    langLabel: "Language:",
    countLabel: "Players:",
    add: "+ Add Image",
    toggle: "Toggle Uploaded Images",
    start: "Start Game",
    score: "Score",
    turn: "Current Player",
    win: " wins!",
    draw: "It's a draw!"
  }
};

function setLanguage() {
  lang = document.getElementById("lang").value;
  document.getElementById("title").textContent = text[lang].title;
  document.getElementById("langLabel").textContent = text[lang].langLabel;
  document.getElementById("countLabel").textContent = text[lang].countLabel;
  document.getElementById("addBtn").textContent = text[lang].add;
  document.getElementById("toggleBtn").textContent = text[lang].toggle;
  document.getElementById("startBtn").textContent = text[lang].start;
  drawPlayerNames();
}

function drawPlayerNames() {
  const pn = document.getElementById("playerNames");
  const count = parseInt(document.getElementById("playerCount").value);
  pn.innerHTML = "";
  playerNames = [];
  for (let i = 0; i < count; i++) {
    const label = document.createElement("label");
    label.textContent = lang === "ja" ? `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i+1}ï¼š` : `Player ${i+1}:`;
    const input = document.createElement("input");
    input.type = "text";
    input.placeholder = lang === "ja" ? `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i+1}` : `Player ${i+1}`;
    input.id = `pname${i+1}`;
    pn.appendChild(label);
    pn.appendChild(input);
    pn.appendChild(document.createElement("br"));
  }
}

function addImage() {
  const fileInput = document.getElementById("imgInput");
  const file = fileInput.files[0];
  if (file && file.type.startsWith("image/")) {
    const reader = new FileReader();
    reader.onload = ev => {
      imgs.push(ev.target.result);
      drawPreview();
      document.getElementById("startBtn").disabled = imgs.length < 2;
    };
    reader.readAsDataURL(file);
  }
}

function drawPreview() {
  const preview = document.getElementById("preview");
  preview.innerHTML = "";
  imgs.forEach((src, i) => {
    const wrapper = document.createElement("div");
    wrapper.style.display = "inline-block";
    wrapper.style.position = "relative";
    wrapper.style.margin = "4px";

    const im = new Image();
    im.src = src;
    im.width = 60;

    const del = document.createElement("button");
    del.textContent = "Ã—";
    del.onclick = () => {
      imgs.splice(i, 1);
      drawPreview();
      document.getElementById("startBtn").disabled = imgs.length < 2;
    };

    wrapper.appendChild(im);
    wrapper.appendChild(del);
    preview.appendChild(wrapper);
  });
}

function toggleUploaded() {
  const pre = document.getElementById("preview");
  pre.style.display = pre.style.display === "none" ? "block" : "none";
}

function startGame() {
  const area = document.getElementById("gameArea");
  area.innerHTML = "";
  const names = [];
  const count = parseInt(document.getElementById("playerCount").value);
  for (let i = 0; i < count; i++) {
    const val = document.getElementById(`pname${i+1}`).value.trim();
    names.push(val || (lang === "ja" ? `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i+1}` : `Player ${i+1}`));
  }
  playerNames = names;
  scores = Array(count).fill(0);
  turn = 0;
  cards = [...imgs, ...imgs].sort(() => Math.random() - 0.5);
  matched = Array(cards.length).fill(false);
  isGameStarted = true;
  drawStatus();
  cards.forEach((src, idx) => {
    const card = document.createElement("div");
    card.className = "card hidden";
    card.onclick = () => flipCard(idx, card);
    area.appendChild(card);
  });
}

function drawStatus() {
  const s = playerNames.map((n, i) => `${n}: ${scores[i]}`).join(" / ");
  document.getElementById("status").textContent =
    `${text[lang].turn}: ${playerNames[turn]} ï½œ ${text[lang].score}: ${s}`;
}

function flipCard(idx, el) {
  if (!isGameStarted || flipped.length === 2 || matched[idx]) return;
  el.classList.remove("hidden");
  el.style.backgroundImage = `url('${cards[idx]}')`;
  flipped.push({idx, el});
  if (flipped.length === 2) checkMatch();
}

function checkMatch() {
  const [a, b] = flipped;
  if (cards[a.idx] === cards[b.idx]) {
    matched[a.idx] = matched[b.idx] = true;
    showModal(cards[a.idx]);
    scores[turn]++;
    setTimeout(() => {
      flipped = [];
      drawStatus();
      if (matched.every(x => x)) {
        declareWinner();
      }
    }, 600);
  } else {
    setTimeout(() => {
      a.el.classList.add("hidden");
      b.el.classList.add("hidden");
      a.el.style.backgroundImage = b.el.style.backgroundImage = "";
      flipped = [];
      turn = (turn + 1) % scores.length;
      drawStatus();
    }, 800);
  }
}

function declareWinner() {
  const max = Math.max(...scores);
  const winners = playerNames.filter((_, i) => scores[i] === max);
  const msg = winners.length === 1 ? winners[0] + text[lang].win : text[lang].draw;
  alert(msg);
}

function showModal(src) {
  const overlay = document.getElementById("modalOverlay");
  document.getElementById("modalImg").src = src;
  overlay.style.display = "flex";
}

function hideModal() {
  document.getElementById("modalOverlay").style.display = "none";
}

window.onload = () => {
  setLanguage();
};
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç¥çµŒè¡°å¼±ï¼ˆæœ€å¤§4äººå¯¾æˆ¦ï¼‰</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    #preview img { border:1px solid #aaa; margin:4px; width:60px; }
    #preview button {
      position:absolute; top:-10px; right:-10px;
      background:red; color:white; border:none; border-radius:50%; cursor:pointer;
    }
    .card { width:80px; height:80px; margin:4px; display:inline-block; border:1px solid #ccc; background:#eee; cursor:pointer; background-size:cover; }
    .hidden { background:#999 !important; }
    #modalOverlay {
      position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:none; justify-content:center; align-items:center; z-index:10;
    }
    #modalOverlay img { max-width:60%; border:5px solid white; border-radius:8px; }
  </style>
</head>
<body>
<h2 id="title">ç¥çµŒè¡°å¼±ï¼ˆæœ€å¤§4äººå¯¾æˆ¦ï¼‰</h2>
<div>
  <label><span id="langLabel">è¨€èª:</span>
    <select id="lang" onchange="setLanguage()">
      <option value="ja">æ—¥æœ¬èª</option><option value="en">English</option>
    </select>
  </label>
  <label><span id="countLabel">ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼äººæ•°:</span>
    <select id="playerCount" onchange="drawPlayerNames()">
      <option value="1">1</option><option value="2" selected>2</option><option value="3">3</option><option value="4">4</option>
    </select>
  </label>
</div>
<div id="playerNames" style="margin-top:10px;"></div>
<p>
  <input type="file" id="imgInput" accept="image/*">
  <button onclick="addImage()" id="addBtn">ï¼‹ç”»åƒã‚’è¿½åŠ </button>
  <button onclick="toggleUploaded()" id="toggleBtn">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒã‚’è¡¨ç¤º</button>
</p>
<div id="preview"></div>
<p><button id="startBtn" disabled onclick="startGame()">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button></p>
<hr>
<div id="status"></div>
<div id="gameArea"></div>

<div id="modalOverlay" onclick="hideModal()"><img id="modalImg" src=""></div>

<script>
let imgs = [], isGameStarted = false, flipped = [], matched = [], cards = [];
let turn = 0, scores = [], lang = "ja", playerNames = [];

const text = {
  ja: {
    title: "ç¥çµŒè¡°å¼±ï¼ˆæœ€å¤§4äººå¯¾æˆ¦ï¼‰",
    langLabel: "è¨€èª:",
    countLabel: "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼äººæ•°:",
    add: "ï¼‹ç”»åƒã‚’è¿½åŠ ",
    toggle: "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒã‚’è¡¨ç¤º",
    start: "ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ",
    score: "ã‚¹ã‚³ã‚¢",
    turn: "ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼",
    win: "ã®å‹ã¡ã§ã™ï¼",
    draw: "å¼•ãåˆ†ã‘ã§ã™ï¼"
  },
  en: {
    title: "Photo Memory Game (Up to 4 Players)",
    langLabel: "Language:",
    countLabel: "Players:",
    add: "+ Add Image",
    toggle: "Toggle Uploaded Images",
    start: "Start Game",
    score: "Score",
    turn: "Current Player",
    win: " wins!",
    draw: "It's a draw!"
  }
};

function setLanguage() {
  lang = document.getElementById("lang").value;
  document.getElementById("title").textContent = text[lang].title;
  document.getElementById("langLabel").textContent = text[lang].langLabel;
  document.getElementById("countLabel").textContent = text[lang].countLabel;
  document.getElementById("addBtn").textContent = text[lang].add;
  document.getElementById("toggleBtn").textContent = text[lang].toggle;
  document.getElementById("startBtn").textContent = text[lang].start;
  drawPlayerNames();
}

function drawPlayerNames() {
  const pn = document.getElementById("playerNames");
  const count = parseInt(document.getElementById("playerCount").value);
  pn.innerHTML = "";
  playerNames = [];
  for (let i = 0; i < count; i++) {
    const label = document.createElement("label");
    label.textContent = lang === "ja" ? `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i+1}ï¼š` : `Player ${i+1}:`;
    const input = document.createElement("input");
    input.type = "text";
    input.placeholder = lang === "ja" ? `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i+1}` : `Player ${i+1}`;
    input.id = `pname${i+1}`;
    pn.appendChild(label);
    pn.appendChild(input);
    pn.appendChild(document.createElement("br"));
  }
}

function addImage() {
  const fileInput = document.getElementById("imgInput");
  const file = fileInput.files[0];
  if (file && file.type.startsWith("image/")) {
    const reader = new FileReader();
    reader.onload = ev => {
      imgs.push(ev.target.result);
      drawPreview();
      document.getElementById("startBtn").disabled = imgs.length < 2;
    };
    reader.readAsDataURL(file);
  }
}

function drawPreview() {
  const preview = document.getElementById("preview");
  preview.innerHTML = "";
  imgs.forEach((src, i) => {
    const wrapper = document.createElement("div");
    wrapper.style.display = "inline-block";
    wrapper.style.position = "relative";
    wrapper.style.margin = "4px";

    const im = new Image();
    im.src = src;
    im.width = 60;

    const del = document.createElement("button");
    del.textContent = "Ã—";
    del.onclick = () => {
      imgs.splice(i, 1);
      drawPreview();
      document.getElementById("startBtn").disabled = imgs.length < 2;
    };

    wrapper.appendChild(im);
    wrapper.appendChild(del);
    preview.appendChild(wrapper);
  });
}

function toggleUploaded() {
  const pre = document.getElementById("preview");
  pre.style.display = pre.style.display === "none" ? "block" : "none";
}

function startGame() {
  const area = document.getElementById("gameArea");
  area.innerHTML = "";
  const names = [];
  const count = parseInt(document.getElementById("playerCount").value);
  for (let i = 0; i < count; i++) {
    const val = document.getElementById(`pname${i+1}`).value.trim();
    names.push(val || (lang === "ja" ? `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i+1}` : `Player ${i+1}`));
  }
  playerNames = names;
  scores = Array(count).fill(0);
  turn = 0;
  cards = [...imgs, ...imgs].sort(() => Math.random() - 0.5);
  matched = Array(cards.length).fill(false);
  isGameStarted = true;
  drawStatus();
  cards.forEach((src, idx) => {
    const card = document.createElement("div");
    card.className = "card hidden";
    card.onclick = () => flipCard(idx, card);
    area.appendChild(card);
  });
}

function drawStatus() {
  const s = playerNames.map((n, i) => `${n}: ${scores[i]}`).join(" / ");
  document.getElementById("status").textContent =
    `${text[lang].turn}: ${playerNames[turn]} ï½œ ${text[lang].score}: ${s}`;
}

function flipCard(idx, el) {
  if (!isGameStarted || flipped.length === 2 || matched[idx]) return;
  el.classList.remove("hidden");
  el.style.backgroundImage = `url('${cards[idx]}')`;
  flipped.push({idx, el});
  if (flipped.length === 2) checkMatch();
}

function checkMatch() {
  const [a, b] = flipped;
  if (cards[a.idx] === cards[b.idx]) {
    matched[a.idx] = matched[b.idx] = true;
    showModal(cards[a.idx]);
    scores[turn]++;
    setTimeout(() => {
      flipped = [];
      drawStatus();
      if (matched.every(x => x)) {
        declareWinner();
      }
    }, 600);
  } else {
    setTimeout(() => {
      a.el.classList.add("hidden");
      b.el.classList.add("hidden");
      a.el.style.backgroundImage = b.el.style.backgroundImage = "";
      flipped = [];
      turn = (turn + 1) % scores.length;
      drawStatus();
    }, 800);
  }
}

function declareWinner() {
  const max = Math.max(...scores);
  const winners = playerNames.filter((_, i) => scores[i] === max);
  const msg = winners.length === 1 ? winners[0] + text[lang].win : text[lang].draw;
  alert(msg);
}

function showModal(src) {
  const overlay = document.getElementById("modalOverlay");
  document.getElementById("modalImg").src = src;
  overlay.style.display = "flex";
}

function hideModal() {
  document.getElementById("modalOverlay").style.display = "none";
}

window.onload = () => {
  setLanguage();
};
</script>
</body>
</html>

  <title>ç¥çµŒè¡°å¼± å¯¾æˆ¦ãƒ¢ãƒ¼ãƒ‰</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f0f0f0; }
    #gameBoard { display: grid; grid-template-columns: repeat(4, 100px); gap: 10px; justify-content: center; margin-top: 20px; }
    .card { width: 100px; height: 100px; background: #ccc; position: relative; cursor: pointer; }
    .card img { width: 100%; height: 100%; object-fit: cover; display: block; }
    #uploadedList img { width: 50px; height: 50px; object-fit: cover; margin: 5px; }
    .image-entry { display: inline-block; position: relative; margin: 5px; }
    .remove-btn {
      position: absolute; top: 0; right: 0;
      background: red; color: white; border: none;
      font-size: 12px; cursor: pointer; padding: 2px 5px;
    }
  </style>
</head>
<body>
  <h2>ç¥çµŒè¡°å¼±ï¼ˆæœ€å¤§4äººå¯¾æˆ¦ï¼‰</h2>
  <label>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼äººæ•°: 
    <select id="playerCount">
      <option value="1">1äºº</option>
      <option value="2" selected>2äºº</option>
      <option value="3">3äºº</option>
      <option value="4">4äºº</option>
    </select>
  </label>
  <div id="nameInputs" style="margin: 10px;"></div>
  <p id="turnInfo">ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼: 1</p>
  <p id="scoreInfo">ã‚¹ã‚³ã‚¢ - ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1: 0 / ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2: 0</p>

  <p>â‘  ã€Œç”»åƒã‚’é¸æŠã€ã§ç”»åƒã‚’ <strong>1æšãšã¤è¿½åŠ </strong><br>
     â‘¡ æœ€ä½2æšè¿½åŠ å¾Œã€ã€Œã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆã€ãƒœã‚¿ãƒ³ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚</p>

  <input type="file" id="imageUploader" accept="image/*" />
  <button id="addImageBtn">â• ç”»åƒã‚’è¿½åŠ </button>
  <button id="toggleUploadedBtn">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒã‚’éè¡¨ç¤º</button>
  <div id="uploadedList" style="display:block;"></div>

  <br><button id="startButton" disabled>ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  <div id="gameBoard"></div>

  <div id="imageModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);justify-content:center;align-items:center;z-index:999;">
    <img id="modalImage" src="" style="max-width:80%;max-height:80%;">
  </div>

  <script>
    let uploadedImages = [];
    let playerCount = 2;
    let currentPlayer = 0;
    let scores = [0, 0, 0, 0];
    let playerNames = ["ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼1", "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼2", "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼3", "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼4"];
    let firstCard = null;
    let lockBoard = false;
    let hideUploaded = false;

    function updateUploadedList() {
      const list = document.getElementById("uploadedList");
      const currentDisplay = list.style.display;
      list.style.display = "block";
      list.innerHTML = "";
      uploadedImages.forEach((src, index) => {
        const entry = document.createElement("div");
        entry.className = "image-entry";
        const img = document.createElement("img");
        img.src = src;
        const btn = document.createElement("button");
        btn.textContent = "Ã—";
        btn.className = "remove-btn";
        btn.onclick = () => {
          uploadedImages.splice(index, 1);
          updateUploadedList();
          document.getElementById("startButton").disabled = uploadedImages.length < 2;
        };
        entry.appendChild(img);
        entry.appendChild(btn);
        list.appendChild(entry);
      });
      list.style.display = currentDisplay;
    }

    document.getElementById("addImageBtn").onclick = () => {
      const file = document.getElementById("imageUploader").files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (e) {
        uploadedImages.push(e.target.result);
        updateUploadedList();
        if (uploadedImages.length >= 2) {
          document.getElementById("startButton").disabled = false;
        }
      };
      reader.readAsDataURL(file);
      document.getElementById("imageUploader").value = "";
    };

    document.getElementById("toggleUploadedBtn").onclick = function () {
      hideUploaded = !hideUploaded;
      const list = document.getElementById("uploadedList");
      list.style.display = hideUploaded ? "none" : "block";
      this.textContent = hideUploaded ? "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒã‚’è¡¨ç¤º" : "ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ç”»åƒã‚’éè¡¨ç¤º";
    };

    document.getElementById("playerCount").addEventListener("change", function() {
      const nameInputs = document.getElementById("nameInputs");
      nameInputs.innerHTML = "";
      playerCount = parseInt(this.value);
      scores = [0, 0, 0, 0];
      playerNames = [];
      for (let i = 0; i < playerCount; i++) {
        const input = document.createElement("input");
        input.type = "text";
        input.placeholder = "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼" + (i + 1);
        input.value = "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼" + (i + 1);
        input.dataset.index = i;
        input.addEventListener("input", () => {
          playerNames[i] = input.value || "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼" + (i + 1);
          updateScoreDisplay();
        });
        nameInputs.appendChild(input);
        playerNames[i] = input.value;
      }
      updateScoreDisplay();
    });

    function updateScoreDisplay() {
      const nameFallback = index => playerNames[index] || "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼" + (index + 1);
      let scoreText = [];
      for (let i = 0; i < playerCount; i++) {
        scoreText.push(`${nameFallback(i)}: ${scores[i]}`);
      }
      document.getElementById("scoreInfo").textContent = "ã‚¹ã‚³ã‚¢ - " + scoreText.join(" / ");
      document.getElementById("turnInfo").textContent = "ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼: " + nameFallback(currentPlayer);
    }

    function checkWin() {
      const totalPairs = uploadedImages.length;
      const totalScore = scores.slice(0, playerCount).reduce((a, b) => a + b, 0);
      if (totalScore === totalPairs) {
        let maxScore = Math.max(...scores.slice(0, playerCount));
        let winners = [];
        for (let i = 0; i < playerCount; i++) {
          if (scores[i] === maxScore) {
            winners.push(playerNames[i] || "ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼" + (i + 1));
          }
        }
        setTimeout(() => {
          alert("ğŸ‰ å‹è€…: " + winners.join("ãƒ»") + "ï¼ˆã‚¹ã‚³ã‚¢: " + maxScore + "ï¼‰");
        }, 100);
      }
    }

    document.getElementById("startButton").onclick = () => {
      const board = document.getElementById("gameBoard");
      board.innerHTML = "";
      const pairs = [...uploadedImages, ...uploadedImages].sort(() => 0.5 - Math.random());
      pairs.forEach(src => {
        const card = document.createElement("div");
        card.className = "card";
        const img = document.createElement("img");
        img.src = src;
        img.style.visibility = "hidden";
        card.appendChild(img);
        card.onclick = () => handleCardClick(card);
        board.appendChild(card);
      });
      currentPlayer = 0;
      scores = [0, 0, 0, 0];
      updateScoreDisplay();
    };

    const modal = document.getElementById("imageModal");
    const modalImage = document.getElementById("modalImage");
    modal.onclick = () => { modal.style.display = "none"; };

    function handleCardClick(card) {
      if (lockBoard || card.classList.contains("flipped")) return;
      const img = card.querySelector("img");
      img.style.visibility = "visible";
      card.classList.add("flipped");

      if (!firstCard) {
        firstCard = card;
        return;
      }

      const secondCard = card;
      lockBoard = true;

      const img1 = firstCard.querySelector("img").src;
      const img2 = secondCard.querySelector("img").src;

      if (img1 === img2) {
        setTimeout(() => {
          modal.style.display = "flex";
          modalImage.src = img1;
          const checkClose = setInterval(() => {
            if (modal.style.display === "none") {
              firstCard.classList.remove("flipped");
              secondCard.classList.remove("flipped");
              scores[currentPlayer]++;
              updateScoreDisplay();
              checkWin();
              lockBoard = false;
              firstCard = null;
              clearInterval(checkClose);
            }
          }, 200);
        }, 500);
      } else {
        setTimeout(() => {
          firstCard.querySelector("img").style.visibility = "hidden";
          secondCard.querySelector("img").style.visibility = "hidden";
          firstCard.classList.remove("flipped");
          secondCard.classList.remove("flipped");
          currentPlayer = (currentPlayer + 1) % playerCount;
          updateScoreDisplay();
          lockBoard = false;
          firstCard = null;
        }, 1000);
      }
    }
  </script>
</body>
</html>
